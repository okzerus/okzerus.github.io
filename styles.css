:root{
  --bg-dark:#0b0f13; --card-dark:#0f1520; --accent-dark:#e6eef6; --muted-dark:#9aa6b2; --btn-bg-dark:#182029;
  --bg-light:#f9f9fb; --card-light:#ffffff; --accent-light:#132029; --muted-light:#66707a; --btn-bg-light:#eef3f6;
  --tooltip-link-color: #bfe8ff; /* pale light blue for tooltip links */
  --tooltip-min-height: 220px;    /* adjust min height of tooltip (affects image area) */
  --tooltip-image-ratio: 0.5;     /* fraction of tooltip height that is image (0..1) */
}

/* theme vars */
html[data-theme="dark"]{
  --bg:var(--bg-dark); --card:var(--card-dark); --accent:var(--accent-dark); --muted:var(--muted-dark); --btn-bg:var(--btn-bg-dark); --btn-fg:var(--accent-dark);
}
html[data-theme="light"]{
  --bg:var(--bg-light); --card:var(--card-light); --accent:var(--accent-light); --muted:var(--muted-light); --btn-bg:var(--btn-bg-light); --btn-fg:var(--accent-light);
}

body{
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  margin:0; background:var(--bg); color:var(--accent);
  transition: filter 220ms ease;
}

/* header */
header{
  background:var(--card); padding:10px 16px; box-shadow:0 1px 0 rgba(0,0,0,0.06);
  display:flex; align-items:center; gap:12px;
}
header h1{margin:0; font-size:18px; font-weight:700; flex:1}
.header-controls{display:flex;gap:8px}

/* theme toggle */
#theme-toggle{
  width:40px; height:40px; border-radius:10px; border:0; background:var(--btn-bg); color:var(--btn-fg);
  font-size:16px; cursor:pointer; box-shadow:0 6px 12px rgba(0,0,0,0.12); display:flex; align-items:center; justify-content:center;
}
#theme-toggle:hover{ transform:translateY(-1px); }
#theme-toggle:active{ transform:translateY(0); }

/* layout */
main{ display:block; padding:18px; }

/* chapters aside */
#chapters-list{
  width:220px; background:var(--card); padding:12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.06);
  position:fixed; left:0; top:72px; bottom:18px; overflow:auto; z-index:1200;
  transform:translateX(calc(-100% + 12px));
  transition: transform 220ms cubic-bezier(.2,.9,.3,1);
  will-change: transform;
}
body.chapters-open #chapters-list{ transform:translateX(0); }

/* chapter list items */
#chapters-list h2{ margin:0 0 8px 0; font-size:16px; font-weight:700 }
#chapters-list ul{list-style:none;padding:0;margin:0}
#chapters-list li{margin:8px 0}
#chapters-list a{
  color:var(--accent); text-decoration:none;
  display:block;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width: calc(220px - 24px);
  padding-right:6px;
}
#chapters-list a.undone { color: var(--muted); text-decoration: line-through; pointer-events: none; cursor: default; opacity: 0.75; }

/* content area centered */
#content{
  max-width: 960px;
  margin: 18px auto;
  background:var(--card);
  padding:24px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
}

/* center images inside chapter text */
#chapter-body img{
  display: block;
  margin: 18px auto;
  max-width: 100%;
  height: auto;
  cursor: zoom-in;
}

/* responsiveness */
@media (max-width:1100px){
  #content{ max-width:760px; padding:20px; }
}
@media (max-width:700px){
  #content{ max-width: calc(100% - 20px); margin: 12px auto; }
  #chapters-list{ display:none; }
}

/* chapter title */
#chapter-title{font-size:40px; font-weight:700; margin-bottom:8px}

/* nav buttons */
.chapter-nav{ display:flex; gap:12px; align-items:center; }
.nav-btn{ width:56px; height:40px; border-radius:8px; border:0; background:var(--btn-bg); color:var(--btn-fg); font-size:16px; cursor:pointer; box-shadow:0 6px 12px rgba(0,0,0,0.12); }
.nav-btn:disabled{opacity:0.35; pointer-events:none}
#bottom-nav{ margin-top:24px; justify-content:center; transition: opacity 180ms ease; }

/* top nav */
#top-nav{
  position:fixed;
  left:50%;
  transform: translateX(-50%) translateY(-6px);
  z-index:1300;
  opacity:0;
  transition: opacity 260ms ease, transform 260ms ease;
  pointer-events:none;
  display:flex;
  gap:12px;
}
#top-nav.visible-top{ opacity:1; transform: translateX(-50%) translateY(0); pointer-events:auto; }

/* blur when chapters open */
body.chapters-open header,
body.chapters-open main > *:not(#chapters-list) {
  filter: blur(4px);
  transition: filter 220ms ease;
}

/* gloss */
.gloss{ text-decoration:underline dotted; cursor:help; }

/* tippy tweaks: ensure tooltip on top and padding handled via wrapper */
.tippy-box{ z-index: 99999 !important; }
.tippy-box .tippy-content { padding: 0; box-sizing: border-box; overflow: visible; }

/* tooltip link color */
.tippy-box .tippy-content a,
.tippy-box a {
  color: var(--tooltip-link-color) !important;
  text-decoration: underline;
}

/* tooltip wrapper: this contains the image (absolutely positioned) and the textual body */
.tippy-box .tippy-content .tooltip-wrapper{
  position: relative;
  min-height: var(--tooltip-min-height);    /* guarantees meaningful image area */
  width: 100%;
  overflow: hidden;
  border-radius: 10px;                      /* match tooltip border radius */
  background: inherit;
  box-sizing: border-box;
}

/* image: cover the top portion (percentage controlled by --tooltip-image-ratio) */
.tippy-box .tippy-content .tooltip-wrapper img.tooltip-img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(var(--tooltip-image-ratio) * 100%);
  object-fit: cover;
  display: block;
  border-top-left-radius: inherit;
  border-top-right-radius: inherit;
}

/* text body: placed below the image; padding gives breathing room */
.tippy-box .tippy-content .tooltip-body{
  position: relative;
  padding: 14px;
  padding-top: calc(14px + var(--tooltip-min-height) * var(--tooltip-image-ratio) / var(--tooltip-min-height)); /* equals 14px + image-height */
  /* fallback visual: ensure bottom half has same background as tooltip */
  background: transparent;
  color: inherit;
  box-sizing: border-box;
}

/* small screens */
@media (max-width:700px){
  #top-nav{ right:10px; left:auto; transform:none; }
  :root{ --tooltip-min-height: 160px; } /* reduce tooltip min height on mobile */
}
